# 基本設計書：Amazon販売KPI管理ツール

**バージョン**: 1.1  
**更新日**: 2025年8月2日  
**更新内容**: マカドCSV処理改善、KPI計算機能強化

## 1. システム概要

### 1.1 システム名称
Amazon販売KPI管理ツール（Googleスプレッドシート版）

### 1.2 システムの目的
- Amazonセラーセントラルとマカドのデータを統合し、月利80万円達成に向けたKPI管理を実現
- リアルタイムに近い形で販売状況を可視化し、データドリブンな意思決定を支援
- 在庫管理の最適化により、キャッシュフローの改善を図る
- 返品・キャンセルデータを含む包括的な売上分析

### 1.3 システムの範囲
- Amazon SP-APIを通じた販売・在庫データの自動取得
- マカドCSVデータの取り込みと統合（Shift-JISエンコーディング対応）
- 返品・キャンセルデータの適切な処理
- KPI算出とダッシュボード表示（リアルタイム更新）
- アラート通知機能（目標未達、在庫異常検知）
- データエクスポート機能
- 重複データの自動検知・除外

### 1.4 利用者
- Amazon物販事業者（1名での運用を想定）
- 将来的には複数人での利用も考慮

## 2. システム構成

### 2.1 アーキテクチャ概要
```
┌─────────────────┐     ┌─────────────────┐     ┌─────────────────┐
│  Amazon SP-API  │     │   マカド CSV    │     │   Keepa API     │
└────────┬────────┘     └────────┬────────┘     └────────┬────────┘
         │                       │                       │
         └───────────────────────┴───────────────────────┘
                                 │
                    ┌────────────┴────────────┐
                    │   Google Apps Script    │
                    │  (データ取得・処理)      │
                    └────────────┬────────────┘
                                 │
                    ┌────────────┴────────────┐
                    │  Google Spreadsheet     │
                    │  (データ保存・表示)      │
                    └────────────┬────────────┘
                                 │
                    ┌────────────┴────────────┐
                    │      ユーザー           │
                    └─────────────────────────┘
```

### 2.2 技術スタック
- **フロントエンド**: Google Spreadsheet
- **バックエンド**: Google Apps Script (GAS)
- **データソース**: 
  - Amazon SP-API (Reports, Orders, Inventory)
  - マカドCSV
  - Keepa API（オプション）
- **通知**: Gmail, Slack（オプション）

### 2.3 システム要件
- Google Workspace アカウント
- Amazon Seller Central アカウント（SP-API利用権限）
- マカドアカウント
- インターネット接続環境

## 3. 機能要件

### 3.1 データ取得機能
| 機能ID | 機能名 | 概要 | 優先度 |
|--------|--------|------|--------|
| F001 | Amazon注文データ取得 | SP-API経由で注文情報を定期取得 | 高 |
| F002 | Amazon在庫データ取得 | FBA在庫情報の日次取得 | 高 |
| F003 | マカドCSV取り込み | CSVファイルの自動/手動取り込み | 高 |
| F004 | Keepaデータ取得 | 商品の価格推移・売れ行き情報 | 中 |

### 3.2 データ処理機能
| 機能ID | 機能名 | 概要 | 優先度 |
|--------|--------|------|--------|
| F005 | データ統合処理 | 複数ソースのデータをSKU/ASINで統合 | 高 |
| F006 | KPI算出処理 | 各種KPIの自動計算・リアルタイム更新 | 高 |
| F007 | データクレンジング | 重複除去、異常値検出、返品データ処理 | 高 |
| F008 | 時系列集計 | 日次/週次/月次での集計処理 | 中 |
| F016 | エンコーディング変換 | Shift-JIS→UTF-8自動変換 | 高 |
| F017 | 返品・キャンセル処理 | 数量0データの適切な処理 | 高 |

### 3.3 表示機能
| 機能ID | 機能名 | 概要 | 優先度 |
|--------|--------|------|--------|
| F009 | KPIダッシュボード | 主要KPIの可視化 | 高 |
| F010 | 商品別分析画面 | SKU/ASIN別の詳細分析 | 中 |
| F011 | 在庫管理画面 | 在庫状況の一覧表示 | 高 |
| F012 | アラート表示 | 閾値超過時の警告表示 | 中 |

### 3.4 通知機能
| 機能ID | 機能名 | 概要 | 優先度 |
|--------|--------|------|--------|
| F013 | エラー通知 | データ取得失敗時のメール通知 | 高 |
| F014 | KPIアラート | 目標値乖離時の通知 | 中 |
| F015 | 定期レポート | 日次/週次サマリーの自動送信 | 低 |

## 4. 非機能要件

### 4.1 パフォーマンス要件
- データ更新処理：10分以内で完了
- 画面表示：3秒以内でレスポンス
- 同時実行：1ユーザーでの利用を想定

### 4.2 セキュリティ要件
- API認証情報の暗号化保存
- アクセス権限の適切な設定
- 操作ログの記録

### 4.3 可用性要件
- Google Spreadsheetの可用性に準拠（99.9%）
- 日次バックアップの実施

### 4.4 保守性要件
- モジュール化された実装
- エラーログの詳細記録
- ドキュメントの整備

## 5. データ設計

### 5.1 スプレッドシート構成
| シート名 | 用途 | 更新頻度 |
|----------|------|----------|
| KPI月次管理 | 月次KPIサマリー | 日次 |
| 販売履歴 | 全注文明細 | リアルタイム |
| 仕入履歴 | 仕入データ | 都度 |
| 在庫一覧 | 現在庫状況 | 日次 |
| ASIN/SKUマスタ | 商品マスタ情報 | 都度 |
| データ連携ログ | 処理履歴 | 自動 |

### 5.2 主要データ項目
#### 販売履歴
- 注文ID（プライマリキー）
- 注文日時
- ASIN
- SKU（統一SKU）
- 販売価格
- 仕入原価
- Amazon手数料
- 粗利益
- ステータス

#### 在庫一覧
- SKU（プライマリキー）
- ASIN
- 商品名
- 在庫数
- 在庫金額
- 回転日数
- 最終入荷日
- 最終販売日

## 6. インターフェース設計

### 6.1 外部インターフェース
- Amazon SP-API（REST API）
- マカドCSV（ファイル）
- Keepa API（REST API）

### 6.2 画面インターフェース
- Googleスプレッドシートのネイティブ機能を活用
- カスタムメニューによる操作
- 条件付き書式による視覚的フィードバック

## 7. 処理フロー

### 7.1 日次バッチ処理
```
1. Amazon SP-APIからデータ取得
2. マカドCSVの確認・取り込み
3. データクレンジング・統合
4. KPI算出
5. ダッシュボード更新
6. アラートチェック・通知
```

### 7.2 リアルタイム処理
- 手動実行によるデータ更新
- 個別商品の情報取得

## 8. エラー処理方針

### 8.1 エラー分類
- API接続エラー
- データ形式エラー
- 処理タイムアウト
- 権限エラー

### 8.2 エラー対応
- リトライ処理（3回まで）
- エラーログ記録
- 管理者への通知
- 部分的な処理継続

## 9. セキュリティ設計

### 9.1 認証・認可
- Google アカウントによる認証
- スプレッドシートの共有設定による権限管理

### 9.2 データ保護
- API認証情報のProperties Service保存
- 個人情報のマスキング
- 通信の暗号化（HTTPS）

## 10. 移行計画

### 10.1 段階的導入
1. Phase 1: 基本機能実装（2週間）
2. Phase 2: 自動化実装（1週間）
3. Phase 3: 高度な分析機能（2週間）
4. Phase 4: 運用最適化（継続的）

### 10.2 データ移行
- 既存データのインポート機能
- 過去データの一括取り込み

## 11. 運用・保守計画

### 11.1 定期メンテナンス
- 月次でのデータアーカイブ
- 四半期でのパフォーマンスチューニング

### 11.2 監視項目
- API利用状況
- エラー発生率
- 処理時間

## 12. KPI定義（詳細）

### 12.1 月次KPI
| KPI名 | 計算式 | 目標値 | 説明 |
|-------|--------|--------|------|
| 売上高 | 販売価格 × 数量の合計 | 3,200,000円 | 月間総売上金額 |
| 粗利益 | 売上高 - 仕入原価 - 手数料 | 800,000円 | 月利目標額 |
| 利益率 | 粗利益 ÷ 売上高 × 100 | 25% | 収益性指標 |
| ROI | 粗利益 ÷ 仕入原価 × 100 | 30% | 投資効率指標 |
| 在庫回転率 | 売上原価 ÷ 平均在庫金額 | 1回/月 | 在庫効率指標 |
| 滞留在庫率 | 30日以上未販売商品数 ÷ 総商品数 | 10%以下 | 在庫健全性指標 |

### 12.2 日次KPI
| KPI名 | 計算式 | 説明 |
|-------|--------|------|
| 本日売上 | 当日の販売金額合計 | 日次売上実績 |
| 本日利益 | 当日の粗利益合計 | 日次利益実績 |
| 成長率 | (本日実績 - 7日平均) ÷ 7日平均 × 100 | 前週比成長率 |

### 12.3 アラート閾値
- 月利目標達成率 80%未満：高優先度アラート
- 在庫回転率 0.5未満：中優先度アラート
- 滞留在庫率 15%超過：中優先度アラート

## 13. 今後の拡張計画

### 13.1 短期（3ヶ月以内）
- モバイル対応（スプレッドシートアプリ）
- 追加KPIの実装
- 予測分析機能

### 13.2 中長期（3ヶ月以降）
- Webアプリケーション化
- 複数マーケットプレイス対応
- AI予測機能の追加

## 14. 更新履歴

### Version 1.1 (2025-08-02)
- マカドCSV処理の改善（Shift-JISエンコーディング対応）
- 返品・キャンセルデータの適切な処理機能追加
- KPI計算機能の大幅強化（リアルタイム更新）
- アラート機能の実装
- 重複データ検知・除外機能の追加
- 詳細なデバッグログ機能の実装